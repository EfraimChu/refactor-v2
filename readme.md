## 重构



---


### 第一章：重构例子

> 设想有一个戏剧演出团，演员们经常要去各种场合表演戏剧。通常客户（customer）会指定几出剧目，而剧团则根据观众（audience）人数及剧目类型来向客户收费。该团目前出演两种戏剧：悲剧（tragedy）和喜剧（comedy）。给客户发出账单时，剧团还会根据到场观众的数量给出“观众量积分”（volume credit）优惠，下次客户再请剧团表演时可以使用积分获得折扣——你可以把它看作一种提升客户忠诚度的方式。

看代码


---


### 何为好的代码？

==人们能够轻而易举地修改它==

### 重构过程
1. 通读代码，理解代码
2. 发现深层次的设计问题
3. 执行重构

==重构基本功==：识别坏味道、测试先行、行为保持的变更动作。


---

### 重构十六字心法：
>旧的不变，
新的创建，
一步切换，
旧的再见。

1. 如果你要给程序添加一个特性，但发现代码因缺乏良好的结构而不易于进行更改，那就先重构那个程序，使其比较容易添加该特性，然后再添加该特性


### 怎么样算步骤比较大？

==重构过程失败时，没办法第一时间定位问题原因时==

--- 




## 重构 第二章

> 重构的意义不在于把代码库打磨得闪闪发光，而是纯粹经济角度出发的考量。我们之所以重构，因为它能让我们更快——添加功能更快，修复bug更快。

--- 


### 1　何谓重构 45

>重构： 不改变外在行为，而提高代码质量


-   效果：行为完全一致。
    
-   重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。
    
-   重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。
    
---

### 2　两顶帽子 46

区分： 添加新功能和重构


---


### 3　为何重构 47

1.  重构改进软件的设计；
    
2.  重构使软件更容易理解
    
    1.  所谓程序设计，很大程度上就是与计算机对话：我编写代码告诉计算机做什么事，而它的响应是按照我的指示精确行动。一言以蔽之，我所做的就是填补“我想要它做什么”和“我告诉它做什么”之间的缝隙
        
3.  重构帮助找到bug
    
4.  重构提高编程速度
    

“设计耐久性假说”：通过投入精力改善内部设计，我们增加了软件的耐久性，从而可以更长时间地保持开发的快速

--- 

###  4　何时重构 50

三次法则：事不过三，三则重构。

见机行事的重构：并不专门安排一段时间来重构，而是在添加功能或修复bug的同时顺便重构

1.  预备性重构：让添加新功能更容易
    
2.  帮助理解的重构：使代码更易懂
    
3.  捡垃圾式重构； 如果发现当下做的功能，涉及到一个重构点，顺手重构即可
    
4.  有计划的重构和见机行事的重构
    

--- 

有计划的重构： 专门留出时间进行重构

长期重构：花费比较长的时间进行重构。

复审code review代码时重构： 最好和作者在一起讨论功能实现

何时不应该重构：

1.  功能不修改到乱代码时，不需要重构
    
2.  重写比重构容易
    

---

### 5　重构的挑战 55

1.  延缓新功能开发
    
2.  代码所有权
	1. 没有权限修改
	2. 重构的代码不在当前团队维护

3. 分支维护混乱

4. 缺乏测试
5. 历史代码
6. 数据库设计
	1. 数据迁移成本

    ---
	

###  6　重构、架构和YAGNI 62

重构和架构：

在编码之前先完成架构”这种做法最大的问题在于，它假设了软件的需求可以预先充分理解。但经验显示，这个假设很多时候甚至可以说大多数时候是不切实际的。

强调:演进式架构

---

###  7　重构与软件开发过程 63

三大实践：自测试代码、持续集成、重构——彼此之间有着很强的协同效应。

有这三大核心实践打下的基础，才谈得上运用敏捷思想的其他部分。

不管采用什么方法，软件开发都是一件复杂而微妙的事，涉及人与人之间、人与机器之间的复杂交互

8　重构与性能 64

大多数时候不需要考虑损耗的性能。

9　重构起源何处 67

10　自动化重构 68

jetbrains的工具